# EternalBlue Exploit | MS17-010

![image](https://hackmd.io/_uploads/SkQgdHCJ0.png)

link bài lab: https://tryhackme.com/r/room/blue

- đầu tiên mình sẽ scan các dịch vụ đang chạy ở máy victim với nmap

```bash
nmap -sC -sV 10.10.50.44
```

![image](https://hackmd.io/_uploads/rygBEXRkA.png)

- và mình được 3 dịch vụ chạy với port dưới 1000 trong đó có port 445 là dịch vụ SMB trên Window 7

![image](https://hackmd.io/_uploads/r1b8EXC1C.png)

- mình lên google tìm kiếm về dịch vụ chạy trên port 445 và thấy được cách khai thác lỗ hổng EternalBlue

![image](https://hackmd.io/_uploads/BJ9YV7RyA.png)

![image](https://hackmd.io/_uploads/HkFi6XAkC.png)

- tiếp đến mình vào metasploit để khai thác lỗ hổng này trên máy victim

![image](https://hackmd.io/_uploads/B16VrQAyA.png)

- module để khai thác lỗ hổng eternalBlue có id 0

![image](https://hackmd.io/_uploads/S1SbLQCk0.png)

- mình dùng module khai thác này và xem các option cần cấu hình thấy được cần xác định RHOSTS

![image](https://hackmd.io/_uploads/BJ9DLXCkA.png)

![image](https://hackmd.io/_uploads/SyvqpQ01C.png)

- tiếp theo mình tiến hành thiết lập các require

![image](https://hackmd.io/_uploads/BJqpL70JR.png)

- do dùng vpn để kết nối đến lab này nên mình cần cấu hình listen host về máy mình kết nối vpn đến

![image](https://hackmd.io/_uploads/r1HMvmCkR.png)

![image](https://hackmd.io/_uploads/Hyu8wXRkR.png)

- tiếp đó chúng ta cũng có thể xem được thông tin về các vecto khai thác trong module này

![image](https://hackmd.io/_uploads/Sk1cwXAk0.png)

- và mình dùng lệnh **run** để bắt đầu tấn công

![image](https://hackmd.io/_uploads/S1PLOQR10.png)

- và mình đã vào được meterpreter để thực thi lệnh trên máy victim

![image](https://hackmd.io/_uploads/SJlEYXRJC.png)

![image](https://hackmd.io/_uploads/HJUFtXAJR.png)

- tiếp theo đến task Escalate

![image](https://hackmd.io/_uploads/HytAtQ0yA.png)

![image](https://hackmd.io/_uploads/rkMXcXC1C.png)

![image](https://hackmd.io/_uploads/r1ISqXAkC.png)

![image](https://hackmd.io/_uploads/rJwFT7RJA.png)

- với task Cracking

  - mình dùng hashdump để hiện data trong SAM và được 3 user và đề hỏi chúng ta đâu không phải user mặc định trong hệ thống và nó chính là user Jon

![image](https://hackmd.io/_uploads/SyXxom0kC.png)

- mình crack password của user Jon được **alqfna22**

![image](https://hackmd.io/_uploads/SJu0jXAkR.png)

![image](https://hackmd.io/_uploads/HyZOpQ01A.png)

- tiếp theo mình vào hệ thống tìm các file flag và thấy được đường dẫn đến các file này

![image](https://hackmd.io/_uploads/ryXwnmCkA.png)

- mình vào đọc file và được các flag

![image](https://hackmd.io/_uploads/HynxTXRJA.png)

![image](https://hackmd.io/_uploads/BybDpX01R.png)

- tiếp theo mình có thể theo dõi màn hình của victim
  - mình chụp ảnh màn hình của victim được

![image](https://hackmd.io/_uploads/rypT0Q0JA.png)

- mình xem các tiến trình chạy trên máy victim được:

![image](https://hackmd.io/_uploads/SkOIkNAJA.png)

- mình quay lại màn hình của victim thấy được mình đang ở màn hình đăng nhập:

![image](https://hackmd.io/_uploads/BkrSgVAJ0.png)

- mình có thể xem user hiện tại mình đang tương tác

![image](https://hackmd.io/_uploads/SJ3vWER1A.png)

- và mình có thể đăng nhập tài khoản của user Jon với password mình vừa crack với lệnh sau

```bash
echo alqfna22 | runas /user:Jon "cmd"
```

![image](https://hackmd.io/_uploads/S1cnX4Ak0.png)

- mình cũng có thể thay đổi mật khẩu của user Jon về rỗng

![image](https://hackmd.io/_uploads/S1O0E40y0.png)

![image](https://hackmd.io/_uploads/SJYFVERkR.png)
